"use strict";var goodMorningAngularApp=angular.module("goodMorningAngularApp",["ui.bootstrap","ngCookies","authServices","stickyServices","bookmarkServices","velibstationServices","weatherreportServices","kunidayServices","kunidayFilters"]);goodMorningAngularApp.config(["$routeProvider","$locationProvider",function(e,o){e.when("/",{templateUrl:"views/preauth.html",controller:"PreAuthCtrl"}).when("/home",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/weather",{templateUrl:"views/weather.html",controller:"WeatherCtrl"}).when("/kunidays",{templateUrl:"views/kunidays.html",controller:"KunidaysCtrl"}).when("/news",{templateUrl:"views/news.html",controller:"NewsCtrl"}).when("/bookmarks",{templateUrl:"views/bookmarks.html",controller:"BookmarksCtrl"}).otherwise({redirectTo:"/"}),o.html5Mode(!0)}]),goodMorningAngularApp.factory("goodMorningInterceptor",["$q","$location","$rootScope","$cookieStore",function(e,o,t,n){return function(e){var r=function(e){return console.log("promise success"),e},a=function(){console.log("promise fail"),n.remove("authToken"),t.logged=!1,o.path("/")};return e.then(r,a)}}]),goodMorningAngularApp.config(["$httpProvider",function(e){e.responseInterceptors.push("goodMorningInterceptor")}]),goodMorningAngularApp.run(["$rootScope","$cookieStore",function(e,o){e.logged=(e.authToken=o.get("authToken"))?!0:!1}]),Date.prototype.getWeek=function(){var e=this;e.setHours(0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));var o=new Date(e.getFullYear(),0,1);return Math.ceil(((e-o)/864e5+o.getDay()+1)/7)},goodMorningAngularApp.controller("MainCtrl",["$scope","$filter","$cookieStore","StickyBoard","Bookmark","WeatherReport","VelibStation","KuniDaySingle",function(e,o,t,n,r,a,i,u){var s=t.get("authToken"),l=new Date;new Date(l.getFullYear(),12,31),e.hours=l.getHours(),e.wday=l.getDay(),e.bookmarks=r.query({authToken:s}),e.orderBookmarks="id",e.velibStations=i.query({authToken:s}),e.sticky=n.pull({authToken:s}),e.kuniDay=u.today({authToken:s}),e.weatherReport=a.query({authToken:s}),e.pushStickyboard=function(){s=t.get("authToken"),n.push({authToken:s},{content:this.sticky.content})},e.pullStickyboard=function(){s=t.get("authToken"),e.sticky=n.pull({authToken:s})}}]),goodMorningAngularApp.controller("PreAuthCtrl",["$scope",function(){}]),goodMorningAngularApp.controller("AuthCtrl",["$scope","$rootScope","$location","$cookieStore","Auth",function(e,o,t,n,r){e.email=usernamePrefill,e.password=passwordPrefill,e.isCollapsed=!0,e.signin=function(){var a=r.signin({email:this.email,password:this.password},function(){n.put("authToken",a.authentication_token),e.authToken=a.authentication_token,e.username=a.user.email,o.logged=!0,t.path("/home/")})},e.signout=function(){var e=n.get("authToken");r.signout({authToken:e},function(){n.remove("authToken"),o.logged=!1,t.path("/")})}}]),goodMorningAngularApp.controller("NewsCtrl",["$scope",function(){}]),goodMorningAngularApp.controller("BookmarksCtrl",["$scope",function(){}]),goodMorningAngularApp.controller("WeatherCtrl",["$scope",function(){}]),goodMorningAngularApp.controller("KunidaysCtrl",["$scope","$filter","$cookieStore","KuniDay",function(e,o,t,n){var r=t.get("authToken"),a=new Date,i=new Date(a.getFullYear(),12,31);e.hours=a.getHours(),e.wday=a.getDay(),e.kuniDays=n.query({authToken:r}),e.tWeek=a.getWeek(),e.tYear=a.getFullYear(),e.tWeek==i.getWeek()?(e.nWeek=1,e.nYear=e.tYear+1):(e.nWeek=e.tWeek+1,e.nYear=e.tYear),e.kuniSwitch=function(t,a,i,u,s){void 0==s&&(s="");var l=[{id:0,status:""},{id:1,status:"kt1"},{id:2,status:"kt2"},{id:3,status:"free"},{id:4,status:"unsure"}],c=o("filter")(l,s);if(4==c[0].id)var k=0;else var k=c[0].id+1;void 0==e.kuniDays[a][i]&&(e.kuniDays[a][i]={}),e.kuniDays[a][i][u]=l[k].status,n.save({authToken:r},{year:t,week:a,weekday:i,am:e.kuniDays[a][i].am,pm:e.kuniDays[a][i].pm})}}]),angular.module("authServices",["ngResource"]).factory("Auth",["$resource","$cookieStore",function(e){return e(backendUrl+"users/:action.json?authentication_token=:authToken",{},{signin:{method:"POST",params:{action:"sign_in"}},signout:{method:"DELETE",params:{action:"sign_out"}}})}]),angular.module("stickyServices",["ngResource","ngCookies"]).factory("StickyBoard",["$resource","$cookieStore",function(e){return e(backendUrl+"/stickyboards/:stickyId.json?authentication_token=:authToken",{stickyId:1},{push:{method:"PUT"},pull:{method:"GET"}})}]),angular.module("bookmarkServices",["ngResource","ngCookies"]).factory("Bookmark",["$resource","$cookieStore",function(e){return e(backendUrl+"bookmarks.json?authentication_token=:authToken",{},{})}]),angular.module("weatherreportServices",["ngResource"]).factory("WeatherReport",["$resource",function(e){return e(backendUrl+"weatherreports.json?authentication_token=:authToken",{},{query:{method:"GET",params:{},isArray:!1}})}]),angular.module("velibstationServices",["ngResource"]).factory("VelibStation",["$resource",function(e){return e(backendUrl+"velibstations.json?authentication_token=:authToken",{},{})}]),angular.module("kunidayServices",["ngResource"]).factory("KuniDay",["$resource",function(e){return e(backendUrl+"kunidays.json?authentication_token=:authToken",{},{query:{method:"GET",params:{},isArray:!1},save:{method:"POST",params:{},isArray:!1}})}]).factory("KuniDaySingle",["$resource",function(e){var o=new Date,t=o.getFullYear()+"-"+("0"+(o.getMonth()+1)).slice(-2)+"-"+("0"+o.getDate()).slice(-2);return e(backendUrl+"kunidays/:date.json?authentication_token=:authToken",{},{today:{method:"GET",params:{date:t},isArray:!1}})}]),angular.module("kunidayFilters",[]).filter("KuniLabel",function(){var e={free:"label-info",kt1:"label-important",kt2:"label-important",unsure:"label-warning"};return function(o){return e[o]}});