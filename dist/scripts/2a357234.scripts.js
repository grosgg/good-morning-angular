"use strict";var goodMorningAngularApp=angular.module("goodMorningAngularApp",["ui.bootstrap","ngCookies","authServices","stickyServices","bookmarkServices","velibstationServices","newsstreamServices","weatherreportServices","kunidayServices","kunidayFilters"]);goodMorningAngularApp.config(["$routeProvider","$locationProvider",function(e){e.when("/",{templateUrl:"views/preauth.html",controller:"PreAuthCtrl"}).when("/home",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/weather",{templateUrl:"views/weather.html",controller:"WeatherCtrl"}).when("/kunidays",{templateUrl:"views/kunidays.html",controller:"KunidaysCtrl"}).when("/news",{templateUrl:"views/newsstreams.html",controller:"NewsStreamCtrl"}).when("/bookmarks",{templateUrl:"views/bookmarks.html",controller:"BookmarksCtrl"}).when("/preferences",{templateUrl:"views/preferences.html",controller:"PreferencesCtrl"}).otherwise({redirectTo:"/"})}]),goodMorningAngularApp.factory("goodMorningInterceptor",["$q","$location","$rootScope","$cookieStore",function(e,t,o,r){return function(e){var n=function(e){return e},a=function(){r.remove("authToken"),o.logged=!1,t.path("/")};return e.then(n,a)}}]),goodMorningAngularApp.config(["$httpProvider",function(e){e.responseInterceptors.push("goodMorningInterceptor")}]),goodMorningAngularApp.run(["$rootScope","$cookieStore",function(e,t){e.logged=(e.authToken=t.get("authToken"))?!0:!1,e.weatherBackground="neutral-background"}]),Date.prototype.getWeek=function(){var e=this;e.setHours(0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));var t=new Date(e.getFullYear(),0,1);return Math.ceil(((e-t)/864e5+t.getDay()+1)/7)},goodMorningAngularApp.controller("MainCtrl",["$scope","$filter","$cookieStore","StickyBoard","Bookmark","WeatherReport","VelibStation","KuniDaySingle",function(e,t,o,r,n,a,u,i){var s=o.get("authToken"),l=new Date;new Date(l.getFullYear(),12,31),e.hours=l.getHours(),e.wday=l.getDay(),e.bookmarks=n.query({authToken:s}),e.orderBookmarks="id",e.reverseBookmarks=!0,e.velibStations=u.query({authToken:s}),e.sticky=r.pull({authToken:s}),e.kuniDay=i.today({authToken:s}),e.weatherReport=a.home({authToken:s}),e.pushStickyboard=function(){s=o.get("authToken"),r.push({authToken:s},{content:this.sticky.content})},e.pullStickyboard=function(){s=o.get("authToken"),e.sticky=r.pull({authToken:s})}}]),goodMorningAngularApp.controller("PreAuthCtrl",["$scope",function(){}]),goodMorningAngularApp.controller("AuthCtrl",["$scope","$rootScope","$location","$cookieStore","Auth",function(e,t,o,r,n){e.email=usernamePrefill,e.password=passwordPrefill,e.isCollapsed=!0,e.signin=function(){var a=n.signin({email:this.email,password:this.password},function(){r.put("authToken",a.authentication_token),e.authToken=a.authentication_token,e.username=a.user.email,t.logged=!0,o.path("/home/")})},e.signout=function(){var e=r.get("authToken");n.signout({authToken:e},function(){r.remove("authToken"),t.logged=!1,o.path("/")})}}]),goodMorningAngularApp.controller("NewsStreamCtrl",["$scope","$cookieStore","$dialog","NewsStream","NewsStreamSingle",function(e,t,o,r,n){var a=t.get("authToken");e.alerts=[],e.newsStreams=r.query({authToken:a});var u={keyboard:!1,backdropClick:!0,templateUrl:"views/newsstream_box.html",controller:"NewsStreamBoxCtrl"};e.newsStreamBox=function(t){if(null!=t&&void 0!=t)var n=t;else var n=null;o.dialog(angular.extend(u,{resolve:{item:function(){return angular.copy(n)}}})).open().then(function(t){t&&(t.created_at==t.updated_at?(e.newsStreams=r.query({authToken:a}),e.alerts.push({type:"success",msg:"News stream successfully added."})):(angular.copy(t,n),e.alerts.push({type:"success",msg:"News stream successfully updated."}))),n=void 0})},e.removeStream=function(t){n.remove({authToken:a,id:t},function(){e.alerts.push({type:"success",msg:"News stream successfully deleted."}),e.newsStreams=r.query({authToken:a})},function(){e.alerts.push({type:"error",msg:"News stream not deleted!"})})}}]),goodMorningAngularApp.controller("NewsStreamBoxCtrl",["$scope","$cookieStore","dialog","item","NewsStream","NewsStreamSingle",function(e,t,o,r,n,a){var u=t.get("authToken");e.item=r,e.save=function(){null==r?n.create({authToken:u},{title:e.item.title,url:e.item.url},function(e){o.close(e)},function(){e.alerts.push({type:"error",msg:"News stream not added!"})}):a.update({authToken:u,id:e.item.id},{title:e.item.title,url:e.item.url},function(){o.close(e.item)},function(){e.alerts.push({type:"error",msg:"News stream not updated!"})})},e.cancel=function(){o.close(!1)}}]),goodMorningAngularApp.controller("BookmarksCtrl",["$scope","$cookieStore","$dialog","Bookmark","BookmarkSingle",function(e,t,o,r,n){var a=t.get("authToken");e.alerts=[],e.bookmarks=r.query({authToken:a}),e.orderBookmarks="id",e.reverseBookmarks=!0;var u={keyboard:!1,backdropClick:!0,templateUrl:"views/bookmark_box.html",controller:"BookmarkBoxCtrl"};e.bookmarkBox=function(t){if(null!=t&&void 0!=t)var n=t;else var n=null;o.dialog(angular.extend(u,{resolve:{item:function(){return angular.copy(n)}}})).open().then(function(t){t&&(t.created_at==t.updated_at?(e.bookmarks=r.query({authToken:a}),e.alerts.push({type:"success",msg:"Bookmark successfully created."})):(angular.copy(t,n),e.alerts.push({type:"success",msg:"Bookmark successfully updated."}))),n=void 0})},e.deleteBookmark=function(t,o){n.remove({authToken:a,id:t},function(){e.bookmarks.splice(o,1),e.alerts.push({type:"success",msg:"Bookmark successfully deleted."})},function(){e.alerts.push({type:"error",msg:"Bookmark not deleted!"})})},e.closeAlert=function(t){e.alerts.splice(t,1)}}]),goodMorningAngularApp.controller("BookmarkBoxCtrl",["$scope","$cookieStore","dialog","item","Bookmark","BookmarkSingle",function(e,t,o,r,n,a){var u=t.get("authToken");e.item=r,e.save=function(){null==r?n.create({authToken:u},{title:e.item.title,url:e.item.url,description:e.item.description},function(e){o.close(e)},function(){e.alerts.push({type:"error",msg:"Bookmark not created!"})}):a.update({authToken:u,id:e.item.id},{title:e.item.title,url:e.item.url,description:e.item.description},function(){o.close(e.item)},function(){e.alerts.push({type:"error",msg:"Bookmark not updated!"})})},e.cancel=function(){o.close(!1)}}]),goodMorningAngularApp.controller("WeatherCtrl",["$scope","$rootScope","$cookieStore","WeatherReport",function(e,t,o,r){var n=o.get("authToken");r.full({authToken:n},function(t){e.hourly=t.hourly,e.forecast=t.forecast.simpleforecast.forecastday})}]),goodMorningAngularApp.controller("KunidaysCtrl",["$scope","$filter","$cookieStore","KuniDay",function(e,t,o,r){var n=o.get("authToken"),a=new Date,u=new Date(a.getFullYear(),12,31);e.hours=a.getHours(),e.wday=a.getDay(),e.kuniDays=r.query({authToken:n}),e.tWeek=a.getWeek(),e.tYear=a.getFullYear(),e.tWeek==u.getWeek()?(e.nWeek=1,e.nYear=e.tYear+1):(e.nWeek=e.tWeek+1,e.nYear=e.tYear),e.kuniSwitch=function(o,a,u,i,s){void 0==s&&(s="");var l=[{id:0,status:""},{id:1,status:"kt1"},{id:2,status:"kt2"},{id:3,status:"free"},{id:4,status:"unsure"}],c=t("filter")(l,s);if(4==c[0].id)var k=0;else var k=c[0].id+1;void 0==e.kuniDays[a][u]&&(e.kuniDays[a][u]={}),e.kuniDays[a][u][i]=l[k].status,r.save({authToken:n},{year:o,week:a,weekday:u,am:e.kuniDays[a][u].am,pm:e.kuniDays[a][u].pm})}}]),goodMorningAngularApp.controller("PreferencesCtrl",["$scope",function(){}]),angular.module("authServices",["ngResource"]).factory("Auth",["$resource","$cookieStore",function(e){return e(backendUrl+"users/:action.json?authentication_token=:authToken",{},{signin:{method:"POST",params:{action:"sign_in"}},signout:{method:"DELETE",params:{action:"sign_out"}}})}]),angular.module("stickyServices",["ngResource","ngCookies"]).factory("StickyBoard",["$resource","$cookieStore",function(e){return e(backendUrl+"stickyboards/:stickyId.json?authentication_token=:authToken",{stickyId:1},{push:{method:"PUT"},pull:{method:"GET"}})}]),angular.module("bookmarkServices",["ngResource","ngCookies"]).factory("Bookmark",["$resource","$cookieStore",function(e){return e(backendUrl+"bookmarks.json?authentication_token=:authToken",{},{create:{method:"POST"}})}]).factory("BookmarkSingle",["$resource",function(e){return e(backendUrl+"bookmarks/:id.json?authentication_token=:authToken",{},{update:{method:"PUT"}})}]),angular.module("weatherreportServices",["ngResource"]).factory("WeatherReport",["$resource",function(e){return e(backendUrl+"weatherreports/:action.json?authentication_token=:authToken",{},{home:{method:"GET",params:{action:"home"},isArray:!1},full:{method:"GET",params:{action:"full"},isArray:!1}})}]),angular.module("velibstationServices",["ngResource"]).factory("VelibStation",["$resource",function(e){return e(backendUrl+"velibstations.json?authentication_token=:authToken",{},{})}]),angular.module("newsstreamServices",["ngResource"]).factory("NewsStream",["$resource",function(e){return e(backendUrl+"newsstreams.json?authentication_token=:authToken",{},{create:{method:"POST"}})}]).factory("NewsStreamSingle",["$resource",function(e){return e(backendUrl+"newsstreams/:id.json?authentication_token=:authToken",{},{update:{method:"PUT"}})}]),angular.module("kunidayServices",["ngResource"]).factory("KuniDay",["$resource",function(e){return e(backendUrl+"kunidays.json?authentication_token=:authToken",{},{query:{method:"GET",params:{},isArray:!1},save:{method:"POST",params:{},isArray:!1}})}]).factory("KuniDaySingle",["$resource",function(e){var t=new Date,o=t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2);return e(backendUrl+"kunidays/:date.json?authentication_token=:authToken",{},{today:{method:"GET",params:{date:o},isArray:!1}})}]),angular.module("kunidayFilters",[]).filter("KuniLabel",function(){var e={free:"label-info",kt1:"label-important",kt2:"label-important",unsure:"label-warning"};return function(t){return e[t]}});