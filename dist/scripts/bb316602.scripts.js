"use strict";var goodMorningAngularApp=angular.module("goodMorningAngularApp",["ui.bootstrap","ngCookies","authServices","stickyServices","bookmarkServices","velibstationServices","weatherreportServices","kunidayServices","kunidayFilters"]);goodMorningAngularApp.config(["$routeProvider","$locationProvider",function(e){e.when("/",{templateUrl:"views/preauth.html",controller:"PreAuthCtrl"}).when("/home",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/weather",{templateUrl:"views/weather.html",controller:"WeatherCtrl"}).when("/kunidays",{templateUrl:"views/kunidays.html",controller:"KunidaysCtrl"}).when("/news",{templateUrl:"views/news.html",controller:"NewsCtrl"}).when("/bookmarks",{templateUrl:"views/bookmarks.html",controller:"BookmarksCtrl"}).otherwise({redirectTo:"/"})}]),goodMorningAngularApp.factory("goodMorningInterceptor",["$q","$location","$rootScope","$cookieStore",function(e,o,t,r){return function(e){var n=function(e){return e},a=function(){r.remove("authToken"),t.logged=!1,o.path("/")};return e.then(n,a)}}]),goodMorningAngularApp.config(["$httpProvider",function(e){e.responseInterceptors.push("goodMorningInterceptor")}]),goodMorningAngularApp.run(["$rootScope","$cookieStore",function(e,o){e.logged=(e.authToken=o.get("authToken"))?!0:!1,e.weatherBackground="neutral-background"}]),Date.prototype.getWeek=function(){var e=this;e.setHours(0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));var o=new Date(e.getFullYear(),0,1);return Math.ceil(((e-o)/864e5+o.getDay()+1)/7)},goodMorningAngularApp.controller("MainCtrl",["$scope","$filter","$cookieStore","StickyBoard","Bookmark","WeatherReport","VelibStation","KuniDaySingle",function(e,o,t,r,n,a,i,u){var s=t.get("authToken"),l=new Date;new Date(l.getFullYear(),12,31),e.hours=l.getHours(),e.wday=l.getDay(),e.bookmarks=n.query({authToken:s}),e.orderBookmarks="id",e.reverseBookmarks=!0,e.velibStations=i.query({authToken:s}),e.sticky=r.pull({authToken:s}),e.kuniDay=u.today({authToken:s}),e.weatherReport=a.home({authToken:s}),e.pushStickyboard=function(){s=t.get("authToken"),r.push({authToken:s},{content:this.sticky.content})},e.pullStickyboard=function(){s=t.get("authToken"),e.sticky=r.pull({authToken:s})}}]),goodMorningAngularApp.controller("PreAuthCtrl",["$scope",function(){}]),goodMorningAngularApp.controller("AuthCtrl",["$scope","$rootScope","$location","$cookieStore","Auth",function(e,o,t,r,n){e.email=usernamePrefill,e.password=passwordPrefill,e.isCollapsed=!0,e.signin=function(){var a=n.signin({email:this.email,password:this.password},function(){r.put("authToken",a.authentication_token),e.authToken=a.authentication_token,e.username=a.user.email,o.logged=!0,t.path("/home/")})},e.signout=function(){var e=r.get("authToken");n.signout({authToken:e},function(){r.remove("authToken"),o.logged=!1,t.path("/")})}}]),goodMorningAngularApp.controller("NewsCtrl",["$scope",function(){}]),goodMorningAngularApp.controller("BookmarksCtrl",["$scope","$cookieStore","$dialog","Bookmark","BookmarkSingle",function(e,o,t,r,n){var a=o.get("authToken");e.alerts=[],e.bookmarks=r.query({authToken:a}),e.orderBookmarks="id",e.reverseBookmarks=!0;var i={keyboard:!1,backdropClick:!0,templateUrl:"views/bookmark_box.html",controller:"BookmarkBoxCtrl"};e.bookmarkBox=function(o){if(null!=o&&void 0!=o)var n=o;else var n=null;t.dialog(angular.extend(i,{resolve:{item:function(){return angular.copy(n)}}})).open().then(function(o){o&&(o.created_at==o.updated_at?(e.bookmarks=r.query({authToken:a}),e.alerts.push({type:"success",msg:"Bookmark successfully created."})):(angular.copy(o,n),e.alerts.push({type:"success",msg:"Bookmark successfully updated."}))),n=void 0})},e.deleteBookmark=function(o,t){n.remove({authToken:a,id:o},function(){e.bookmarks.splice(t,1),e.alerts.push({type:"success",msg:"Bookmark successfully deleted."})},function(){e.alerts.push({type:"error",msg:"Bookmark not deleted!"})})},e.closeAlert=function(o){e.alerts.splice(o,1)}}]),goodMorningAngularApp.controller("BookmarkBoxCtrl",["$scope","$cookieStore","dialog","item","Bookmark","BookmarkSingle",function(e,o,t,r,n,a){var i=o.get("authToken");e.item=r,e.save=function(){null==r?n.create({authToken:i},{title:e.item.title,url:e.item.url,description:e.item.description},function(e){t.close(e)},function(){e.alerts.push({type:"error",msg:"Bookmark not created!"})}):a.update({authToken:i,id:e.item.id},{title:e.item.title,url:e.item.url,description:e.item.description},function(){t.close(e.item)},function(){e.alerts.push({type:"error",msg:"Bookmark not updated!"})})},e.cancel=function(){t.close(!1)}}]),goodMorningAngularApp.controller("WeatherCtrl",["$scope","$rootScope","$cookieStore","WeatherReport",function(e,o,t,r){var n=t.get("authToken");r.full({authToken:n},function(o){e.conditions=o.conditions,e.astronomy=o.astronomy,e.hourly=o.hourly,e.forecast=o.forecast.simpleforecast.forecastday,60*parseInt(o.astronomy.current_time.hour)+parseInt(o.astronomy.current_time.minute),60*parseInt(o.astronomy.sunrise.hour)+parseInt(o.astronomy.sunrise.minute),60*parseInt(o.astronomy.sunset.hour)+parseInt(o.astronomy.sunset.minute)})}]),goodMorningAngularApp.controller("KunidaysCtrl",["$scope","$filter","$cookieStore","KuniDay",function(e,o,t,r){var n=t.get("authToken"),a=new Date,i=new Date(a.getFullYear(),12,31);e.hours=a.getHours(),e.wday=a.getDay(),e.kuniDays=r.query({authToken:n}),e.tWeek=a.getWeek(),e.tYear=a.getFullYear(),e.tWeek==i.getWeek()?(e.nWeek=1,e.nYear=e.tYear+1):(e.nWeek=e.tWeek+1,e.nYear=e.tYear),e.kuniSwitch=function(t,a,i,u,s){void 0==s&&(s="");var l=[{id:0,status:""},{id:1,status:"kt1"},{id:2,status:"kt2"},{id:3,status:"free"},{id:4,status:"unsure"}],c=o("filter")(l,s);if(4==c[0].id)var k=0;else var k=c[0].id+1;void 0==e.kuniDays[a][i]&&(e.kuniDays[a][i]={}),e.kuniDays[a][i][u]=l[k].status,r.save({authToken:n},{year:t,week:a,weekday:i,am:e.kuniDays[a][i].am,pm:e.kuniDays[a][i].pm})}}]),angular.module("authServices",["ngResource"]).factory("Auth",["$resource","$cookieStore",function(e){return e(backendUrl+"users/:action.json?authentication_token=:authToken",{},{signin:{method:"POST",params:{action:"sign_in"}},signout:{method:"DELETE",params:{action:"sign_out"}}})}]),angular.module("stickyServices",["ngResource","ngCookies"]).factory("StickyBoard",["$resource","$cookieStore",function(e){return e(backendUrl+"stickyboards/:stickyId.json?authentication_token=:authToken",{stickyId:1},{push:{method:"PUT"},pull:{method:"GET"}})}]),angular.module("bookmarkServices",["ngResource","ngCookies"]).factory("Bookmark",["$resource","$cookieStore",function(e){return e(backendUrl+"bookmarks.json?authentication_token=:authToken",{},{create:{method:"POST"}})}]).factory("BookmarkSingle",["$resource",function(e){return e(backendUrl+"bookmarks/:id.json?authentication_token=:authToken",{},{update:{method:"PUT"}})}]),angular.module("weatherreportServices",["ngResource"]).factory("WeatherReport",["$resource",function(e){return e(backendUrl+"weatherreports/:action.json?authentication_token=:authToken",{},{home:{method:"GET",params:{action:"home"},isArray:!1},full:{method:"GET",params:{action:"full"},isArray:!1}})}]),angular.module("velibstationServices",["ngResource"]).factory("VelibStation",["$resource",function(e){return e(backendUrl+"velibstations.json?authentication_token=:authToken",{},{})}]),angular.module("kunidayServices",["ngResource"]).factory("KuniDay",["$resource",function(e){return e(backendUrl+"kunidays.json?authentication_token=:authToken",{},{query:{method:"GET",params:{},isArray:!1},save:{method:"POST",params:{},isArray:!1}})}]).factory("KuniDaySingle",["$resource",function(e){var o=new Date,t=o.getFullYear()+"-"+("0"+(o.getMonth()+1)).slice(-2)+"-"+("0"+o.getDate()).slice(-2);return e(backendUrl+"kunidays/:date.json?authentication_token=:authToken",{},{today:{method:"GET",params:{date:t},isArray:!1}})}]),angular.module("kunidayFilters",[]).filter("KuniLabel",function(){var e={free:"label-info",kt1:"label-important",kt2:"label-important",unsure:"label-warning"};return function(o){return e[o]}});